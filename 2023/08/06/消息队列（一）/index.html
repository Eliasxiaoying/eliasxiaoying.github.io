<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="A hexo theme">
    <meta name="keyword"  content="dusign, hexo-theme-snail">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          消息队列（一） - Hexo-theme-snail
        
    </title>

    <link rel="canonical" href="https://dusign.net/2023/08/06/消息队列（一）/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-light.css">

        
<link rel="stylesheet" href="/css/dusign-common-light.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

        <!-- background effects end -->
    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('../../../../img/default.jpg')
                /*post*/
            
        
    }
    
    #signature{
        background-image: url('/img/signature/dusign.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#消息队列" title="消息队列">消息队列</a>
                            
                              <a class="tag" href="/tags/#Rocket MQ" title="Rocket MQ">Rocket MQ</a>
                            
                        </div>
                        <h1>消息队列（一）</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by elias on
                            2023-08-06
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                Words <span class="post-count">4.8k</span> and
                                Reading Time <span class="post-count">20</span> Minutes
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-light.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-light.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Super Snail</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">Categories</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/photography/">Photography</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                    
                    <li>
                        <a href="YOUR_CHINESE_BLOG_URL" target="_blank">Chinese Blog</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="消息中间件概述"><a href="#消息中间件概述" class="headerlink" title="消息中间件概述"></a>消息中间件概述</h2><h3 id="系统之间请求的两种方式"><a href="#系统之间请求的两种方式" class="headerlink" title="系统之间请求的两种方式"></a>系统之间请求的两种方式</h3><ol>
<li>RPC远程方法调用 <strong>同步调用，需要等待远程方法返回</strong></li>
<li>MQ消息队列 <strong>异步调用或不需要返回内容，不需要等待远程方法返回</strong></li>
</ol>
<p>RPC（Remote Process Call远程过程调用）的主要功能目标是让构建分布式计算（应用）更容易，在提供强大的远程调用能力时不损失本地调用的语义简洁性.它具有分布式设计、部署灵活、服务解耦、扩展性强等优点。但是通常RPC调用都是同步、阻塞的，且为了实现RPC调用，我们通常还会采用一些其他的方式保证服务的可用性与扩展性，这就带来了微服务中的服务注册与发现、健康检测、负载均衡、服务治理、熔断限流等等相关组件，服务之间产生了强依赖关系，这无疑是背离了RPC的初衷。</p>
<p>而消息队列则刚好提供了另外一种服务之间数据传递与转换的方式。消息队列是异步的、并且只需要维护好消息队列的可用性与扩展性，而无需引入其他组件，此外消息队列还有许多其他的优点。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li>异步解耦：在一个庞大的业务系统中, 通过对于主要业务模块和其他业务模块之间进行业务解耦<ol>
<li>可以保障整体系统的稳定性, 比如物流系统在某一个时刻出现故障, 并不会影响用户下单、浏览商品等其他操作</li>
<li>提高用户的响应速度, 比如以前没有消息中间件, 需要400ms的处理时间, 现在引入消息中间件只需要110ms的处理时间</li>
</ol>
</li>
</ol>
<p><img src="/images/images3.png" alt="upload successful"></p>
<ol>
<li>削峰填谷<ol>
<li>在应用系统架构的时候引入了消息中间件MQ之后, 所有的用户请求全部先到达消息中间件MQ, 然后业务系统从MQ读取对应的消息进行业务处理，假设其中业务系统的处理的封装是1w/qps,。</li>
<li>当用户请求的qps在低于一万的时候, 用户的请求可以正常的处理</li>
<li>当用户请求在某一个时刻突然高于1w/qps的时候，比如在达到3w/qps的时候，对于业务系统则可以达到自己的处理封装1w/qps，消息中间件则可以达到3w/qps，</li>
<li>这个时候会有很多的消息在消息中间件堆积，等待业务系统处理，这时消息中间件起到一个削峰的作用。</li>
<li>当业务系统相对来说比较空闲的时候，用户的请求低于1w/qps的时候，那么对于mq的处理能力是和用户处理能力一样，但是对于应用系统可能还是在维持一个峰值(1w/qps)进行业务处理，这是消息中间件起到一个填谷的作用。</li>
</ol>
</li>
</ol>
<p><img src="/images/images4.png" alt="upload successful"></p>
<ol>
<li>消息分发<ol>
<li>在双十一，618这种大促销活动，商家的同一件商品可能会有很多的分会场，对于价格的变化需要及时的通知到分会场</li>
<li>如果大量的并发访问数据库, 会导致页面响应缓慢, 我们可以通过MQ构建分布式缓存, 及时的通知到分会场商品数据的变化</li>
<li>可以实现数据实时更新，降低页面响应时间，满足大规模的数据访问</li>
</ol>
</li>
</ol>
<p><img src="/images/images5.png" alt="upload successful"></p>
<h3 id="常见的消息中间件"><a href="#常见的消息中间件" class="headerlink" title="常见的消息中间件"></a>常见的消息中间件</h3><p>ActiveMQ、RabbitMQ、Kafka、RocketMQ</p>
<p><img src="/images/images6.png" alt="upload successful"></p>
<h3 id="ROCKETMQ的核心特性"><a href="#ROCKETMQ的核心特性" class="headerlink" title="ROCKETMQ的核心特性"></a>ROCKETMQ的核心特性</h3><ol>
<li>低延迟 1ms内响应的延迟超过99.6%</li>
<li>高稳定性<ol>
<li>服务可用性 99.95%，Region 化、多可用区、分布式集群化部署，确保服务高可用，即便整个机房不可用仍可正常提供消息服务</li>
<li>数据可靠性 99.99999999%，同步双写、超三副本数据冗余与快速切换技术确保数据可靠；</li>
</ol>
</li>
<li>高性能<ol>
<li>历年双 11 购物狂欢节零点千万级 TPS、万亿级数据洪峰，创造了全球最大的业务消息并发以及流转纪录（日志类消息除外）；</li>
<li>在始终保证高性能前提下，支持亿级消息堆积，不影响集群的正常服务，在削峰填谷（蓄洪）、微服务解耦的场景下尤为重要；</li>
</ol>
</li>
<li>丰富的消息类型 提供丰富的消息类型，满足各种严苛场景下的高级特性需求，当前支持的消息类型涵盖普通消息、顺序消息（全局顺序 / 分区顺序）、分布式事务消息、定时消息/延时消息；</li>
</ol>
<h2 id="ROCKETMQ的核心组件"><a href="#ROCKETMQ的核心组件" class="headerlink" title="ROCKETMQ的核心组件"></a>ROCKETMQ的核心组件</h2><h3 id="运行模型"><a href="#运行模型" class="headerlink" title="运行模型"></a>运行模型</h3><ol>
<li>名称服务NameServer，NameServer的作用类似于Zookeeper这样的注册中心，主要用于存储元数据的管理，比如每个Topic的位置信息 </li>
<li>代理服务Broker，Broker是数据处理服务器，对于不同的消息，存储在不同的Topic中，在同一个Topic中，为了提高消息处理的并发能力, 一个Topic会有多个Queue队列</li>
<li>生产者Producer，连接NameServer, 获取对应的Topic信息, 开始创建消息并发送</li>
<li>消费者Consumer，连接NameServer, 获取对应的Topic信息, 开始消费消息</li>
</ol>
<p><img src="/images/images7.png" alt="upload successful"></p>
<h3 id="NameServer"><a href="#NameServer" class="headerlink" title="NameServer"></a>NameServer</h3><p>名称服务充当路由消息队列元数据的提供者，生产者或消费者能够通过名称服务查找各主题相应的Broker IP列表。多个Namesrv实例组成集群，但相互独立，没有信息交换。</p>
<h3 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h3><p>消息代理服务，负责存储消息、转发消息。代理服务器在RocketMQ系统中负责接收从生产者发送来的消息并存储、同时为消费者的拉取请求作准备。代理服务器也存储消息相关的元数据，包括消费者组、消费进度偏移和主题和队列消息等。</p>
<h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><p>表示一类消息的集合，每个主题包含若干条消息，每条消息只能属于一个主题，是RocketMQ进行消息订阅的基本单位。</p>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p>为了提高消息处理的并发度, 每个消息主题Topic会有多个Queue</p>
<h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><p>生产者，负责生产消息，一般由业务系统负责生产消息。<br>一个消息生产者会把业务应用系统里产生的消息发送到Broker服务器。RocketMQ提供多种发送方式，同步发送、异步发送、顺序发送、单向发送。同步和异步方式均需要Broker返回确认信息，单向发送不需要。</p>
<h3 id="Comsumer"><a href="#Comsumer" class="headerlink" title="Comsumer"></a>Comsumer</h3><p>消费者，负责消费消息，一般是后台系统负责异步消费。一个消息消费者会从Broker服务器拉取消息，并将其提供给应用程序。从用户应用的角度而言提供了两种消费形式：拉取式消费、推动式消费。</p>
<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>消息内容 消息系统所传输信息的物理载体，生产和消费数据的最小单位，每条消息必须属于一个主题。RocketMQ中每个消息拥有唯一的Message ID，且可以携带具有业务标识的Key。系统提供了通过Message ID和Key查询消息的功能。</p>
<h2 id="单机环境安装"><a href="#单机环境安装" class="headerlink" title="单机环境安装"></a>单机环境安装</h2><h3 id="ROCKETMQ的安装"><a href="#ROCKETMQ的安装" class="headerlink" title="ROCKETMQ的安装"></a>ROCKETMQ的安装</h3><ol>
<li>源码安装依赖<code>JDK1.8+</code>和<code>Maven3.2+</code></li>
<li>下载源码包到指定的位置：<code>wget https://archive.apache.org/dist/rocketmq/4.7.0/rocketmq-all-4.7.0-source-release.zip</code></li>
<li>解压源码包到/usr/local/src路径下 <code>unzip rocketmq-all-4.7.0-source-release.zip -d /usr/local/src</code></li>
<li>执行maven构建</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn -Prelease-all -Dmanve.test.skip=true clean install -U</span><br><span class="line"><span class="meta">#</span><span class="bash"> -P激活指定的环境</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -U 强制更新本地仓库的文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当构建完成以后, 二进制文件存放在distribution/target目录中</span></span><br></pre></td></tr></table></figure>
<h3 id="管理控制台安装"><a href="#管理控制台安装" class="headerlink" title="管理控制台安装"></a>管理控制台安装</h3><ol>
<li>使用git工具下载源码或自行下载源码<ol>
<li><code>yum install -y git</code></li>
<li><code>git clone https://gitee.com/heshengjun/rocketmq-externals.git</code></li>
</ol>
</li>
<li>执行Maven构建 <code>mvn package -Dmaven.test.skip=true</code></li>
<li>启动管理控制台<ol>
<li>启动rocket服务, 在启动管理控制台之前, 必须先启动NameServer</li>
<li>在启动目录创建一个application.properties，并指定对应的</li>
</ol>
</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 控制台运行端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="comment"># rocketmq的名称服务地址</span></span><br><span class="line"><span class="meta">rocketmq.config.namesrvAddr</span>=<span class="string">127.0.0.1:9876</span></span><br></pre></td></tr></table></figure>
<pre><code>  3. 启动控制台，并在后台运行 `nohup java -jar rocketmq-console-ng-1.0.1.jar &amp;`
</code></pre><h3 id="运行测试程序"><a href="#运行测试程序" class="headerlink" title="运行测试程序"></a>运行测试程序</h3><p>使用rocktmq自带的测试程序对mq进行测试</p>
<ol>
<li>设置名称服务的环境变量 <code>export  NAMESRV_ADDR=127.0.0.1:9876</code></li>
<li>启动生产者 <code>bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</code></li>
<li>启动消费者 <code>bin/tools.sh  org.apache.rocketmq.example.quickstart.Consumer</code></li>
</ol>
<h2 id="基础入门"><a href="#基础入门" class="headerlink" title="基础入门"></a>基础入门</h2><p>maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><ol>
<li>生产者</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生产者入门案例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1 创建一个生产者</span></span><br><span class="line">        DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(<span class="string">"maoge"</span>);</span><br><span class="line">        <span class="comment">//2 指定NameServer的地址</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">"192.168.48.102:9876"</span>);</span><br><span class="line">        <span class="comment">//3 启动生产者</span></span><br><span class="line">        producer.start();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 4 创建消息对象 指定消息的topic为 01_hello</span></span><br><span class="line">            Message msg = <span class="keyword">new</span> Message(<span class="string">"01_hello"</span>, (<span class="string">"hello"</span> + i).getBytes());</span><br><span class="line">            <span class="comment">// 5 发送消息</span></span><br><span class="line">            SendResult result = producer.send(msg);</span><br><span class="line">            System.out.println(result.getSendStatus());</span><br><span class="line">            System.out.println(<span class="string">"result.getMsgId() = "</span> + result.getMsgId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6 关闭应用程序</span></span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>消费者</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消费者案例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException </span>&#123;</span><br><span class="line">        <span class="comment">//1 创建一个消费者对象</span></span><br><span class="line">        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"maoge"</span>);</span><br><span class="line">        <span class="comment">// 设置NameServer的地址</span></span><br><span class="line">        consumer.setNamesrvAddr(<span class="string">"192.168.48.102:9876"</span>);</span><br><span class="line">        <span class="comment">//2 指定消费的topic</span></span><br><span class="line">        consumer.subscribe(<span class="string">"01_hello"</span>,<span class="string">"*"</span>);</span><br><span class="line">        <span class="comment">//3 指定从哪个位置开始消费(只是对第一次启动消费的时候有效果)</span></span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);</span><br><span class="line">        <span class="comment">//4 指定一个监听器, 并发消费消息</span></span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerConcurrently() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt messageExt : list) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">"收到消息:"</span>+<span class="keyword">new</span> String(messageExt.getBody()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//5 启动消费者</span></span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><h4 id="同步发送消息"><a href="#同步发送消息" class="headerlink" title="同步发送消息"></a>同步发送消息</h4><p>指在发送数据到消息中间件的时候, 需要及时的返回消息发送结果到发送方，这种可靠性同步地发送方式使用的比较广泛，比如：重要的消息通知，短信通知。</p>
<p><img src="/images/images8.png" alt="upload successful"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String group = <span class="string">"group1"</span>;</span><br><span class="line">        <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">        DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(group);</span><br><span class="line">        producer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            producer.start();</span><br><span class="line">            Message message = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                message = <span class="keyword">new</span> Message(<span class="string">"_01_sync"</span>, <span class="string">"Hello RocketMQ"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">                SendResult result = producer.send(message);</span><br><span class="line">                System.out.println(JSON.toJSONString(result));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            producer.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="异步发送消息"><a href="#异步发送消息" class="headerlink" title="异步发送消息"></a>异步发送消息</h4><p>指把数据发送到消息中心不等待消息中心的返回结果，而是程序继续往下执行, 当有结果返回的时候, 通过异步通知的方式告诉消息发送方。<br>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p>
<p><img src="/images/images9.png" alt="upload successful"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"group1"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(group);</span><br><span class="line">    producer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">    CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        producer.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"生产者启动失败"</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Message message = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            message = <span class="keyword">new</span> Message(<span class="string">"_02_async"</span>, <span class="string">"Hello RocketMQ"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            producer.send(message, <span class="keyword">new</span> SendCallback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(SendResult sendResult)</span> </span>&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getId());</span><br><span class="line">                    <span class="keyword">if</span> (sendResult.getSendStatus() == SendStatus.SEND_OK) &#123;</span><br><span class="line">                        System.out.println(<span class="string">"消息发送成功"</span> + JSON.toJSONString(sendResult));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">"消息发送失败"</span> + JSON.toJSONString(sendResult));</span><br><span class="line">                    &#125;</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">                    System.out.println(throwable.getMessage());</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"消息发送失败:客户端异常"</span> + e.getMessage());</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemotingException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"消息发送失败:远程异常"</span> + e.getMessage());</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">"消息发送失败:线程中断异常"</span> + e.getMessage());</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="一次性发送消息"><a href="#一次性发送消息" class="headerlink" title="一次性发送消息"></a>一次性发送消息</h4><p>这种方式主要用在不特别关心发送结果的场景，例如日志发送，大数据场景。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"group1"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(group);</span><br><span class="line">    producer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        producer.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            Message message = <span class="keyword">new</span> Message(<span class="string">"_01_sync"</span>, <span class="string">"Hello RocketMQ"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            producer.sendOneway(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="生产者组"><a href="#生产者组" class="headerlink" title="生产者组"></a>生产者组</h4><p>同一类Producer的集合，这类Producer发送同一类消息且发送逻辑一致。如果发送的是事务消息且原始生产者在发送之后崩溃，则Broker服务器会联系同一生产者组的其他生产者实例以提交或回溯消费。生产者在创建时通过producerGroup指定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"group1"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定生产者组名称为group </span></span><br><span class="line">    DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(group);</span><br><span class="line">    producer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        producer.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            Message message = <span class="keyword">new</span> Message(<span class="string">"_01_sync"</span>, <span class="string">"Hello RocketMQ"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            producer.sendOneway(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息封装"><a href="#消息封装" class="headerlink" title="消息封装"></a>消息封装</h4><p>Tag：用来给消息进行标记，可以通过Tag对消息进行分类，把不同类型的消息交给不同的消费者进行消费<br>Key<strong>：</strong>可以设置消息的一个唯一ID，用于区分每个消息的标志，业务ID，并且在管理控制台，可以通过Key进行消息的查询跟踪</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"group1"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(group);</span><br><span class="line">    producer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        producer.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            Message message = <span class="keyword">new</span> Message(<span class="string">"_01_sync"</span>, <span class="string">"TagA"</span>, i + <span class="string">""</span>, <span class="string">"Hello RocketMQ"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            producer.sendOneway(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h3><h4 id="消费方式-拉取消费"><a href="#消费方式-拉取消费" class="headerlink" title="消费方式-拉取消费"></a>消费方式-拉取消费</h4><p>由消费者主动从消息队列中拉取消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String group = <span class="string">"consumer"</span>;</span><br><span class="line">        <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">        DefaultLitePullConsumer consumer = <span class="keyword">new</span> DefaultLitePullConsumer(group);</span><br><span class="line">        consumer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            consumer.subscribe(<span class="string">"_04_pull"</span>, <span class="string">"*"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            consumer.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            List&lt;MessageExt&gt; msgs = consumer.poll();</span><br><span class="line">            msgs.forEach(msg -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> String(msg.getBody()));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="消费方式-推送消费"><a href="#消费方式-推送消费" class="headerlink" title="消费方式-推送消费"></a>消费方式-推送消费</h4><p>由消息队列主动推送消息到消费者（需要消费者先绑定消费事件）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 推式消费 消息中心 主动把消息推送给  消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PushConsumerDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"type"</span>);</span><br><span class="line">        consumer.setNamesrvAddr(<span class="string">"192.168.48.102:9876"</span>);</span><br><span class="line">        <span class="comment">//订阅主题, 后面可以指定表达式Tag, 根据tag进行消息过滤</span></span><br><span class="line">        consumer.subscribe(<span class="string">"01_hello"</span>,<span class="string">"*"</span>);</span><br><span class="line">        <span class="comment">//注册消息消费监听 有消息就会触发consumeMessage方法</span></span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerConcurrently() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"接收消息线程: "</span>+Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">for</span> (MessageExt msg : msgs) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"接收到的消息:"</span>+<span class="keyword">new</span> String(msg.getBody()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//确定消息消费从</span></span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//启动消费者</span></span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消费模式-集群模式"><a href="#消费模式-集群模式" class="headerlink" title="消费模式-集群模式"></a>消费模式-集群模式</h4><p>MessageModel.CLUSTERING：对于同一个消费者组里面的多个消费者, 每个消费者消费的消息都是不一样的, 相当于消费者的负载均衡。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"ConsumerModel"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(group);</span><br><span class="line">    <span class="comment">// 设置消费者的消息模型为集群模式</span></span><br><span class="line">    consumer.setMessageModel(MessageModel.CLUSTERING);</span><br><span class="line">    consumer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String consumerName = <span class="string">"消费者1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        consumer.subscribe(<span class="string">"_05_model"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener((MessageListenerConcurrently) (list, consumeConcurrentlyContext) -&gt; &#123;</span><br><span class="line">            list.forEach(msg -&gt; System.out.println(consumerName + <span class="string">"消费消息:"</span> + list.indexOf(msg) + <span class="string">"成功。"</span> + <span class="keyword">new</span> String(msg.getBody())));</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">        System.out.println(consumerName + <span class="string">"启动成功"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消费模式-广播模式"><a href="#消费模式-广播模式" class="headerlink" title="消费模式-广播模式"></a>消费模式-广播模式</h4><p>MessageModel.BROADCASTING：每个消费者都会接受全量的消息，所有消费者消费的数据都是一样的，一般用于对于消息需要多个其他业务进行处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"ConsumerModel"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(group);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置消费者的消息模型为广播模式</span></span><br><span class="line">    consumer.setMessageModel(MessageModel.BROADCASTING);</span><br><span class="line">    consumer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String consumerName = <span class="string">"消费者1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        consumer.subscribe(<span class="string">"_05_model"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener((MessageListenerConcurrently) (list, consumeConcurrentlyContext) -&gt; &#123;</span><br><span class="line">            list.forEach(msg -&gt; System.out.println(consumerName + <span class="string">"消费消息:"</span> + list.indexOf(msg) + <span class="string">"成功。"</span> + <span class="keyword">new</span> String(msg.getBody())));</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">        System.out.println(consumerName + <span class="string">"启动成功"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认消息会按照轮询的方式发送给Topic中的每个队列，消费者在集群模式下，当连接到主题上时会预先分配消费者将要消费的队列，以实现消息的集群消费。<br>队列数量默认情况下最多为4个。</p>
<h4 id="消息消费位点"><a href="#消息消费位点" class="headerlink" title="消息消费位点"></a>消息消费位点</h4><p>在指定消费的pos位置的时候，会优先获取服务端记录的上次消费点，<strong>该参数只有在服务端没有对应的消费者的记录的时候有效，一般情况是第一次启动的消费者有效。如果存在消费记录会记录消费位点，再次启动时会从指定的消费位点之后开始消费。</strong></p>
<ol>
<li><strong>CONSUME_FROM_FIRST_OFFSET</strong>：从最开始的位置消费，消息该Topic下面所有的有效的数据，过期的数据会删除掉。</li>
<li><strong>CONSUME_FROM_LAST_OFFSET</strong>：如果该Topic的数据都是最近的数据，没有过期数据，则从最开始的位置消费；如果该Topic的数据存在过期的数据，则从最后的位置开始消费，只会消费新加入的数据。</li>
<li><strong>CONSUME_FROM_TIMESTAMP</strong>：根据指定的时间戳进行消费，配合<code>consumer.setConsumeTimestamp(&quot;20200612083300&quot;);</code>从指定的时间开始消费，如果不指定，则默认从半个小时前的数据开始消费。</li>
<li>如果</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"ConsumerModel"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(group);</span><br><span class="line">    consumer.setMessageModel(MessageModel.CLUSTERING);</span><br><span class="line">    consumer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果消息过期，则从最近的消息开始消费</span></span><br><span class="line">    consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定时间之后</span></span><br><span class="line">    consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_TIMESTAMP);</span><br><span class="line">    consumer.setConsumeTimestamp(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        consumer.subscribe(<span class="string">"_06_position"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener((MessageListenerConcurrently) (list, consumeConcurrentlyContext) -&gt; &#123;</span><br><span class="line">            list.forEach(msg -&gt; System.out.println(<span class="keyword">new</span> String(msg.getBody())));</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息消费确认-拉式消费："><a href="#消息消费确认-拉式消费：" class="headerlink" title="消息消费确认-拉式消费："></a>消息消费确认-拉式消费：</h4><ol>
<li>可以通过consumer.setAutoCommit(false)；设置是否自动提交，如果设置为手动提交, 需要使用consumer.commitSync()；方法进行手动提交；</li>
<li>对于未提交的操作，Topic中的订阅的偏移量是不会发生改变的，下次消费的时候会继续消费改数据。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"consumer"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultLitePullConsumer consumer = <span class="keyword">new</span> DefaultLitePullConsumer(group);</span><br><span class="line">    consumer.setNamesrvAddr(nameServer);</span><br><span class="line">    consumer.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        consumer.subscribe(<span class="string">"_07_ack"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;MessageExt&gt; messages = consumer.poll();</span><br><span class="line">        messages.forEach(message -&gt; System.out.println(<span class="string">"消息消费成功："</span> + <span class="keyword">new</span> String(message.getBody())));</span><br><span class="line">        <span class="comment">// 在提交消费成功之前不会确认消费，不会改变偏移量，每次启动都会重新开始消费</span></span><br><span class="line">        consumer.commitSync();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息消费确认-推式消费"><a href="#消息消费确认-推式消费" class="headerlink" title="消息消费确认-推式消费"></a>消息消费确认-推式消费</h4><ol>
<li>通过返回ConsumeConcurrentlyStatus.CONSUME_SUCCESS状态表示消费成功，返回ConsumeConcurrentlyStatus.RECONSUME_LATER 表示消费不成功，会放入到重试队列。</li>
<li>默认重试采用服务端重试；重试次数：16次。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String group = <span class="string">"consumer"</span>;</span><br><span class="line">    <span class="keyword">final</span> String nameServer = <span class="string">"localhost:9876"</span>;</span><br><span class="line"></span><br><span class="line">    DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(group);</span><br><span class="line">    consumer.setNamesrvAddr(nameServer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        consumer.subscribe(<span class="string">"_07_ack"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener((MessageListenerConcurrently) (list, consumeConcurrentlyContext) -&gt; &#123;</span><br><span class="line">            list.forEach(message -&gt; System.out.println(<span class="string">"消息消费成功："</span> + <span class="keyword">new</span> String(message.getBody())));</span><br><span class="line">            <span class="comment">// 稍后再次消费，但是会改变消费者偏移量，但是会放到重试队列中</span></span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/2023/07/30/IdentityServer-介绍/" data-toggle="tooltip" data-placement="top" title="IdentityServer 介绍">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        This is copyright.
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                
<link rel="stylesheet" href="/css/music-player/fonts/iconfont.css">


<link rel="stylesheet" href="/css/music-player/css/reset.css">


<link rel="stylesheet" href="/css/music-player/css/player.css">


<div class="music-player">
    <audio class="music-player__audio" ></audio>
    <div class="music-player__main">
        <div class="music-player__blur"></div>
        <div class="music-player__disc">
            <div class="music-player__image">
                <img width="100%" src="" alt="">
            </div>
            <div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div>
        </div>
        <div class="music-player__controls">
            <div class="music__info">
                <h3 class="music__info--title">...</h3>
                <p class="music__info--singer">...</p>
            </div>
            <div class="player-control">
                <div class="player-control__content">
                    <div class="player-control__btns">
                        <div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div>
                        <div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div>
                        <div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div>
                        <div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-loop"></i></div>
                    </div>
                    <div class="player-control__volume">
                        <div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div>
                        <div class="control__volume--progress player_progress"></div>
                    </div>
                </div>
                <div class="player-control__content">
                    <div class="player__song--progress player_progress"></div>
                    <div class="player__song--timeProgess nowTime">00:00</div>
                    <div class="player__song--timeProgess totalTime">00:00</div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/js/music-player/utill.js"></script>


<script src="/js/music-player/jquery.min.js"></script>

<!-- netease; qqkg -->
<!--
<script src="/js/music-player/player.js?library=config.music.library.js"></script>
-->
<script src="../../../../js/music-player/player.js?library=netease&music=https://kg.qq.com/node/play?s=7deFpz7Z26Jmv7di&g_f=share_html"></script>
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      
        <aside id="sidebar">
          <div id="toc" class="toc-article">
          <strong class="toc-title">Contents</strong>
          
            
              <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#消息中间件概述"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">消息中间件概述</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#系统之间请求的两种方式"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">系统之间请求的两种方式</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#应用场景"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">应用场景</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#常见的消息中间件"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">常见的消息中间件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#ROCKETMQ的核心特性"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">ROCKETMQ的核心特性</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#ROCKETMQ的核心组件"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">ROCKETMQ的核心组件</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#运行模型"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">运行模型</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#NameServer"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">NameServer</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Broker"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">Broker</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Topic"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">Topic</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Queue"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">Queue</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Producer"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">Producer</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Comsumer"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">Comsumer</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Message"><span class="toc-nav-number">2.8.</span> <span class="toc-nav-text">Message</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#单机环境安装"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">单机环境安装</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#ROCKETMQ的安装"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">ROCKETMQ的安装</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#管理控制台安装"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">管理控制台安装</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#运行测试程序"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">运行测试程序</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#基础入门"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">基础入门</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#入门案例"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">入门案例</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#发送消息"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">发送消息</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#同步发送消息"><span class="toc-nav-number">4.2.1.</span> <span class="toc-nav-text">同步发送消息</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#异步发送消息"><span class="toc-nav-number">4.2.2.</span> <span class="toc-nav-text">异步发送消息</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#一次性发送消息"><span class="toc-nav-number">4.2.3.</span> <span class="toc-nav-text">一次性发送消息</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#生产者组"><span class="toc-nav-number">4.2.4.</span> <span class="toc-nav-text">生产者组</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消息封装"><span class="toc-nav-number">4.2.5.</span> <span class="toc-nav-text">消息封装</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#接收消息"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">接收消息</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消费方式-拉取消费"><span class="toc-nav-number">4.3.1.</span> <span class="toc-nav-text">消费方式-拉取消费</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消费方式-推送消费"><span class="toc-nav-number">4.3.2.</span> <span class="toc-nav-text">消费方式-推送消费</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消费模式-集群模式"><span class="toc-nav-number">4.3.3.</span> <span class="toc-nav-text">消费模式-集群模式</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消费模式-广播模式"><span class="toc-nav-number">4.3.4.</span> <span class="toc-nav-text">消费模式-广播模式</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消息消费位点"><span class="toc-nav-number">4.3.5.</span> <span class="toc-nav-text">消息消费位点</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消息消费确认-拉式消费："><span class="toc-nav-number">4.3.6.</span> <span class="toc-nav-text">消息消费确认-拉式消费：</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#消息消费确认-推式消费"><span class="toc-nav-number">4.3.7.</span> <span class="toc-nav-text">消息消费确认-推式消费</span></a></li></ol></li></ol></li></ol>
            
          
          </div>
        </aside>
      
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#消息队列" title="消息队列">消息队列</a>
                        
                          <a class="tag" href="/tags/#Rocket MQ" title="Rocket MQ">Rocket MQ</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://blog.csdn.net/d_Nail" target="_blank">Dusign&#39;s Blog</a></li>
                    
                        <li><a href="#" target="_blank">Dusign&#39;s Web</a></li>
                    
                        <li><a href="https://github.com/dusign" target="_blank">Dusign&#39;s Github</a></li>
                    
                        <li><a href="#" target="_blank">Other</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                
                    <li>
                        <a target="_blank"  href="https://github.com/dusign">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://twitter.com/dusignr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/Gang Du">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/dusignr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Dusign 2023 
                    <br>
                    Powered by 
                    <a href="https://github.com/dusign/hexo-theme-snail" target="_blank" rel="noopener">
                        <i>hexo-theme-snail</i>
                    </a> | 
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=dusign&repo=hexo-theme-snail&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://dusign.net/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        
            <script type="text/javascript" src="/js/mouse-click.js" content='[&quot;🌱&quot;,&quot;just do it&quot;,&quot;🍀&quot;]' color='[&quot;rgb(121,93,179)&quot; ,&quot;rgb(76,180,231)&quot; ,&quot;rgb(184,90,154)&quot;]'></script>
        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>

</html>
